<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AniMemeStation - 3D Model</title>
    <link rel="stylesheet" href="../assets/css/3d-styles.css">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-W9NET4NH9D"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-W9NET4NH9D');
    </script>
</head>
<body>
    <div class="container">
        <nav>
		    <a href="../index.html">Meme</a>
            <a href="../pages/donate.html">Donate</a>
			<a href="../pages/cosplay.html">Cosplay</a>
            <a href="../pages/3D.html">3D</a>
        </nav>
        
        <div id="content-container">
            <div class="content-area">
                <div class="left-content">
                    <div class="english-title">Xem mô hình 3D</div>
                    <div class="model-container">
                        <!-- 3D Model iframe with pointer-events interceptor -->
                        <div class="iframe-container" id="model-iframe-container">
                            <!-- Loading spinner for 3D model -->
                            <div class="loading-spinner" id="model-loading">
                                <div class="spinner"></div>
                                <div class="loading-text">Chờ tí, loading...</div>
                            </div>
                            <!-- 3D model will be loaded here via JavaScript -->
                            <div class="click-interceptor"></div>
                        </div>
                    </div>
                    <div class="slide-controls">
                        <button class="control-btn prev-btn">Quay Lại</button>
                        <div class="slide-counter" id="model-name"><!-- Model name will be inserted here --></div>
                        <button class="control-btn next-btn">Tiếp Theo</button>
                    </div>
                </div>
                
                <div class="right-content">
                    <div class="image-container">
                        <!-- Loading spinner for image -->
                        <div class="loading-spinner" id="image-loading">
                            <div class="spinner"></div>
                            <div class="loading-text">Chờ tí, loading...</div>
                        </div>
                        <img id="model-2d-image" src="" alt="2D Image" class="model-image">
                    </div>
                    <p class="caption">3D Model Được Tạo Bằng AI Nên Chưa Được Hoàn Thiện</p>
                    <p class="caption">Mục Đích Tạo 3D Chỉ Để Giải Trí</p>
                    
                    <!-- Button row -->
                    <div class="button-row">
                        <button class="action-btn meme-btn">Xem Meme</button>
                        <button class="action-btn cosplay-btn">Xem Cosplay</button>
                    </div>
                    <p class="future-msg">Hãy Donate Cho Tôi Tại Trang Donate !!</p>
                </div>
            </div>
        </div>
    </div>

    <script type='text/javascript' src='//snailthreatenedinvited.com/fe/59/70/fe5970384daa1cbda2a9fc77ba16e2f0.js'></script>
    <script type='text/javascript' src='//snailthreatenedinvited.com/ea/a2/39/eaa239929b9579a33b3733ca91118f98.js'></script>

    
    <!-- Ad Popup HTML -->
    <div class="popup-overlay" id="adPopup">
        <div class="popup-container">
            <div class="popup-title">Nhấn vào quảng cáo<br>bất kỳ để đóng cửa sổ này !!</div>
            <div class="ads-container" id="adsContainer">
                <div class="ad-wrapper">
                    <!-- First Ad (hidden on mobile) -->
                    <div class="ad-container mobile-hide">
                        <script type="text/javascript">
                            atOptions = {
                                'key' : '232b712b4f3926add741ef3dacfa845b',
                                'format' : 'iframe',
                                'height' : 250,
                                'width' : 300,
                                'params' : {}
                            };
                            document.write('<scr' + 'ipt type="text/javascript" src="//snailthreatenedinvited.com/232b712b4f3926add741ef3dacfa845b/invoke.js"></scr' + 'ipt>');
                        </script>
                    </div>
                    
                    <!-- Second Ad (hidden on mobile) -->
                    <div class="ad-container mobile-hide">
                        <script type="text/javascript">
                            atOptions = {
                                'key' : '6451bd15ef23dd53fc63133c49a41a32',
                                'format' : 'iframe',
                                'height' : 250,
                                'width' : 300,
                                'params' : {}
                            };
                            document.write('<scr' + 'ipt type="text/javascript" src="//snailthreatenedinvited.com/6451bd15ef23dd53fc63133c49a41a32/invoke.js"></scr' + 'ipt>');
                        </script>
                    </div>
                    
                    <!-- Third Ad (hidden on mobile) -->
                    <div class="ad-container mobile-hide">
                        <script type="text/javascript">
                            atOptions = {
                                'key' : '7c7b5884fcb9c78838bb6fbb2e72739f',
                                'format' : 'iframe',
                                'height' : 250,
                                'width' : 300,
                                'params' : {}
                            };
                            document.write('<scr' + 'ipt type="text/javascript" src="//snailthreatenedinvited.com/7c7b5884fcb9c78838bb6fbb2e72739f/invoke.js"></scr' + 'ipt>');
                        </script>
                    </div>
                    
                    <!-- Fourth Ad -->
                    <div class="ad-container">
                        <script type="text/javascript">
                            atOptions = {
                                'key' : '0e30a5fb7feed2a39cc356e389549986',
                                'format' : 'iframe',
                                'height' : 250,
                                'width' : 300,
                                'params' : {}
                            };
                            document.write('<scr' + 'ipt type="text/javascript" src="//snailthreatenedinvited.com/0e30a5fb7feed2a39cc356e389549986/invoke.js"></scr' + 'ipt>');
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Define setupInterceptors as a global function
        function setupInterceptors(iframe) {
            // Wait for iframe content to be accessible
            setTimeout(() => {
                try {
                    // Create a script element to inject into the iframe
                    const script = document.createElement('script');
                    script.textContent = `
                        // Wait for the DOM to be fully loaded
                        function hideEditTabs() {
                            // First find the p3d-app container
                            const appContainer = document.querySelector(".p3d-app");
                            if (appContainer) {
                                // Now find the edit tabs within the app container
                                const el = document.querySelector(".p3d-edit-tabs");
                                if (el) {
                                    el.style.display = "none";
                                    console.log("Successfully hidden p3d-edit-tabs");
                                    return true;
                                }
                            }
                            
                            // If element not found, try again after a short delay
                            console.log("Elements not found yet, retrying...");
                            setTimeout(hideEditTabs, 500);
                            return false;
                        }
                        
                        // Start the process
                        hideEditTabs();
                    `;
                    
                    // Try to inject the script into the iframe
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    iframeDoc.body.appendChild(script);
                    
                    console.log("Script injected successfully");
                } catch (e) {
                    console.log("Could not access iframe content due to same-origin policy", e);
                }
            }, 2000); // Increased timeout to ensure iframe is fully loaded
        }

        document.addEventListener('DOMContentLoaded', function() {
            const prevBtn = document.querySelector('.prev-btn');
            const nextBtn = document.querySelector('.next-btn');
            const cosplayButton = document.querySelector('.cosplay-btn');
            const memeButton = document.querySelector('.meme-btn');
            const adPopup = document.getElementById('adPopup');
            const clickInterceptor = document.querySelector('.click-interceptor');
            const modelNameElement = document.getElementById('model-name');
            const modelIframeContainer = document.getElementById('model-iframe-container');
            const model2dImage = document.getElementById('model-2d-image');
            const modelLoading = document.getElementById('model-loading');
            const imageLoading = document.getElementById('image-loading');
            let popupCloseCount = 0;
            
            // Define the list of 3D models and their corresponding 2D images
            const modelsList = [
                {
                    modelSrc: "https://p3d.in/e/gznnG+load",
                    imageSrc: "../assets/images/2D/Mitsuri.webp",
                    name: "Mitsuri"
                },
                {
                    modelSrc: "https://p3d.in/e/zgk6N+load",
                    imageSrc: "../assets/images/2D/Android_18.webp",
                    name: "Android 18"
                },
                {
                    modelSrc: "https://p3d.in/e/DFWwb+load",
                    imageSrc: "../assets/images/2D/Rossweisse.webp",
                    name: "Rossweisse"
                },
                {
                    modelSrc: "https://p3d.in/e/KJVEL+load",
                    imageSrc: "../assets/images/2D/Toga_Himiko.webp",
                    name: "Toga Himiko"
                },
                {
                    modelSrc: "https://p3d.in/e/NSbgl+load",
                    imageSrc: "../assets/images/2D/Shark_Girl.webp",
                    name: "Shark Girl"
                },
                {
                    modelSrc: "https://p3d.in/e/AyFEx+load",
                    imageSrc: "../assets/images/2D/Bunny_Girl.webp",
                    name: "Bunny Girl"
                },
                {
                    modelSrc: "https://p3d.in/e/dsTYt+load",
                    imageSrc: "../assets/images/2D/Astra_Yao.webp",
                    name: "Astra Yao"
                },
                {
                    modelSrc: "https://p3d.in/e/9nhyU+load",
                    imageSrc: "../assets/images/2D/The_Nun.webp",
                    name: "The Nun"
                },
                {
                    modelSrc: "https://p3d.in/e/0YbQN+load",
                    imageSrc: "../assets/images/2D/Rem.webp",
                    name: "Rem"
                },
                {
                    modelSrc: "https://p3d.in/e/7QLov+load",
                    imageSrc: "../assets/images/2D/Nami.webp",
                    name: "Nami"
                },
                {
                    modelSrc: "https://p3d.in/e/3yAXQ+load",
                    imageSrc: "../assets/images/2D/Frieren.webp",
                    name: "Frieren"
                }
                
            ];
            
            let currentModelIndex = 0;
            
            // Function to load the current model
            function loadCurrentModel() {
                const currentModel = modelsList[currentModelIndex];
                
                // Show loading spinners
                if (modelLoading) modelLoading.style.display = 'flex';
                if (imageLoading) imageLoading.style.display = 'flex';
                
                // Update iframe
                modelIframeContainer.innerHTML = `
                    <div class="loading-spinner" id="model-loading">
                        <div class="spinner"></div>
                        <div class="loading-text">Chờ tí, loading...</div>
                    </div>
                    <iframe allowfullscreen width="100%" height="100%" loading="lazy" frameborder="0" src="${currentModel.modelSrc}" sandbox="allow-scripts allow-same-origin" onload="this.previousElementSibling.style.display='none'; setupInterceptors(this);"></iframe>
                `;
                
                // Update 2D image
                model2dImage.src = currentModel.imageSrc;
                model2dImage.alt = currentModel.name;
                
                // Hide image loading spinner when image loads
                model2dImage.onload = function() {
                    if (imageLoading) imageLoading.style.display = 'none';
                };
                
                // Update model name in slide counter
                modelNameElement.textContent = currentModel.name;
            }
            
            // Load the initial model
            loadCurrentModel();
            
            // Prevent default behavior for clicks on the interceptor
            clickInterceptor.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            });
            
            // Add event listener for buttons
            memeButton.addEventListener('click', function() {
                window.location.href = 'AniMemeStation.html';
            });
            
            cosplayButton.addEventListener('click', function() {
                window.location.href = 'pages/cosplay.html';
            });
            
            // Function to show ad popup
            function showAdPopup() {
                // Store window.length before showing ads
                const initialWindowLength = Object.keys(window).length;
                
                // Show popup
                adPopup.style.display = 'flex';
                setTimeout(() => {
                    adPopup.classList.add('show');
                }, 10);
                
                // Set up document click handler
                document.addEventListener('click', function clickHandler(event) {
                    // Check after a short delay to allow new window/tab to open
                    setTimeout(() => {
                        // Check if window keys changed (new window opened)
                        const newWindowLength = Object.keys(window).length;
                        if (newWindowLength > initialWindowLength || document.hidden) {
                            // Ad was clicked - close popup
                            closePopupAfterAdClick();
                            document.removeEventListener('click', clickHandler);
                        }
                    }, 500);
                });
                
                // Add visibility change detection for when user returns from ad page
                document.addEventListener('visibilitychange', function visibilityHandler() {
                    if (document.hidden) {
                        // User likely clicked an ad - close popup when they return
                        setTimeout(() => {
                            closePopupAfterAdClick();
                            document.removeEventListener('visibilitychange', visibilityHandler);
                        }, 500);
                    }
                });
            }
            
            // Function to close popup after ad click
            function closePopupAfterAdClick() {
                adPopup.classList.remove('show');
                setTimeout(() => {
                    adPopup.style.display = 'none';
                    
                    // Increment the close count
                    popupCloseCount++;
                    
                    // Set timeout for next popup display
                    if (popupCloseCount === 1) {
                        // Show popup again after 3 minute
                        setTimeout(showAdPopup, 3 * 60 * 1000);
                    } else if (popupCloseCount === 2) {
                        // Show popup again after 4 minutes
                        setTimeout(showAdPopup, 4 * 60 * 1000);
                    }
                }, 500);
            }
            
            // Show ad popup after 1min
            setTimeout(showAdPopup, 60000);
            
            // Add navigation functionality
            prevBtn.addEventListener('click', function() {
                currentModelIndex = (currentModelIndex - 1 + modelsList.length) % modelsList.length;
                loadCurrentModel();
            });
            
            nextBtn.addEventListener('click', function() {
                currentModelIndex = (currentModelIndex + 1) % modelsList.length;
                loadCurrentModel();
            });
        });
    </script>
</body>
</html>